<div class="cursor-example hidden lg:block"></div>
<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {
    // Register GSAP plugins once on load
    gsap.config({ 
      trialWarn: false,
      nullTargetWarn: false, 
      force3D: false, // Disable 3D transforms for better performance
      autoSleep: 60 // Auto-sleep after 60 seconds of inactivity
    });
    
    gsap.registerPlugin(TextPlugin, ScrollTrigger, ScrollSmoother);
    
    // Optimize ScrollTrigger
    ScrollTrigger.config({
      limitCallbacks: true, // Limit callback frequency
      syncInterval: 40 // Sync every 40ms instead of default 16ms
    });
    
    // Only enable ScrollSmoother on desktop and non-work pages
    const isWorkPage = window.location.pathname.includes('/work');
    const isDesktop = window.innerWidth > 1024;
    
    if (isDesktop && !isWorkPage) {
      ScrollSmoother.create({
        smooth: 1.5, // Reduced from 2 for better performance
        effects: true,
        normalizeScroll: false,
        smoothTouch: false, // Disable on touch devices
      });
    } else if (isDesktop && isWorkPage) {
      // Minimal smoothing for work pages
      ScrollSmoother.create({
        smooth: 1,
        effects: false, // Disable effects for better performance
        normalizeScroll: false,
        smoothTouch: false,
      });
    }

    // Curtain animation on page load
    gsap.to(".load-curtain", {
      opacity: 0,
      duration: 0.3,
      delay: 0.1,
    });

    document.addEventListener("click", (e) => {
      const link = e.target.closest("a");

      if (!link) return;

      const target = link.getAttribute("target");

      if (target === "_blank") return; // Let default behavior happen for new tabs

      e.preventDefault();

      // Start curtain animation
      gsap.to(".load-curtain", {
        opacity: 1,
        duration: 0.3,
        onComplete: () => {
          // Navigate after animation
          window.location.href = link.href;
        },
      });
    });
  });
</script>

<style>
  .cursor-example {
    position: fixed;
    top: 0;
    left: 0;
    transition-duration: 0.3s;
    width: 25px;
    height: 25px;
    border-radius: 100%;
    background-color: white;
    pointer-events: none;
  }
</style>